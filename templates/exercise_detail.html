{% extends "base.html" %}
{% block content %}

<div class="d-flex justify-content-between align-items-center mb-3">
  <div>
    <h4 class="mb-0">
      種目詳細：
      {{ exercise_name|default(exercise_label)|default('（種目名未設定）') }}
    </h4>
    <div class="small text-muted">
      プラン：{{ plan.title }}　/　計画日：{{ plan.planned_date }}
    </div>
  </div>

  <div class="d-flex gap-2">
    <a href="{{ url_for('plan_detail', plan_id=plan.id) }}"
       class="btn btn-sm btn-outline-secondary">
      プラン詳細に戻る
    </a>
  </div>
</div>

<hr class="my-3">

<h5 class="mb-2">この種目の実施ログ</h5>
{% if logs %}
  <table class="table table-hover align-middle">
    <thead>
      <tr>
        <th>実施日</th>
        <th>回数</th>
        <th>時間 (hh:mm:ss)</th>
        <th>メモ</th>
      </tr>
    </thead>
    <tbody>
    {% for r in logs %}
      <tr>
        <td>{{ r.actual_date }}</td>
        <td>
          {% if r.reps is not none %}
            {{ r.reps }}
          {% else %}
            -
          {% endif %}
        </td>
        <td>{{ r.duration_str }}</td>
        <td class="small">{{ r.notes or "" }}</td>
      </tr>
    {% endfor %}
    </tbody>
  </table>
{% else %}
  <p class="text-muted">まだこの種目のログはありません。</p>
{% endif %}

<hr class="my-3">

<h5 class="mb-2">この種目に時間を追加（ストップウォッチ）</h5>

<form method="post" class="card p-3 shadow-sm" style="max-width:700px;">

  <div class="row g-3">
    <div class="col-md-4">
      <label class="form-label">実施日</label>
      <input type="date" name="actual_date" class="form-control"
             value="{{ today }}" required>
    </div>
    <div class="col-md-4">
      <label class="form-label">回数（任意）</label>
      <input type="number" name="reps" class="form-control"
             min="0" placeholder="例：10">
    </div>
  </div>

  <!-- 🔽 共通ストップウォッチブロック（plan_detail と同じ仕様） -->
  <div class="mt-3 mb-2 stopwatch-container">

    <label class="form-label">カウントダウン設定</label>
    <div class="form-check form-switch mb-1">
      <input class="form-check-input stopwatch-countdown-toggle" type="checkbox" id="useCountdownSwitchExercise">
      <label class="form-check-label" for="useCountdownSwitchExercise">
        Start 前にカウントダウン音声を使う
      </label>
    </div>

    <div class="d-flex align-items-center gap-2 mb-2">
      <label class="form-label mb-0 small">カウントダウン秒数（最大10秒）</label>
      <input type="number"
             class="form-control form-control-sm stopwatch-countdown-seconds"
             style="width:80px;"
             value="5" min="1" max="10">
    </div>

    <div class="form-text mb-2">
      例：5 にすると「5,4,3,2,1,0」と女性の声（WAV）でカウントダウンしてから 0:00:00 でスタートします。
    </div>

    <div class="mt-3">
      <div class="d-flex align-items-center gap-3 mb-2">
        <div class="fs-3 fw-bold stopwatch-display">00:00:00</div>
        <!-- サーバーに送る合計秒数（この種目の実施時間） -->
        <input type="hidden"
               name="seconds_total"
               class="stopwatch-seconds-input"
               value="0">
      </div>

      <div class="d-flex gap-2 mb-3">
        <button type="button" class="btn btn-success btn-sm stopwatch-start">Start</button>
        <button type="button" class="btn btn-warning btn-sm stopwatch-stop">Stop</button>
        <button type="button" class="btn btn-secondary btn-sm stopwatch-reset">Reset</button>
      </div>

      <div class="form-text">
        カウントダウンを ON にすると、-00:00:05 → … → -00:00:00 とマイナス表示しながら
        「5,4,3,2,1,0」と読み上げ、その後は 00:00:01, 00:00:02 … とカウントアップします。
      </div>
    </div>

  </div>
  <!-- 🔼 共通ストップウォッチブロック -->

  <div class="mb-3 mt-3">
    <label class="form-label">メモ（任意）</label>
    <textarea name="notes" class="form-control" rows="3"
              placeholder="今回の感想やフォームの気づきなど"></textarea>
  </div>

  <div class="d-flex gap-2">
    <button class="btn btn-primary">この種目の時間を追加</button>
    <a href="{{ url_for('plan_detail', plan_id=plan.id) }}"
       class="btn btn-outline-secondary">
      プラン詳細に戻る
    </a>
  </div>

</form>

{% endblock %}
